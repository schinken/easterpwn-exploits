#!/usr/bin/python2.7

import StringIO
import ftplib
import re
import sys

# Connection information
server = sys.argv[1]

# Establish the connection
ftp = ftplib.FTP()
ftp.connect(server, 10022)

ftp.login('anonymous', 'blabla')

# Change to the proper directory
ftp.cwd('/incoming')

# Loop through matching files ...
for filename in ftp.nlst('*.dat*'):

    tmp = StringIO.StringIO()
    ftp.retrbinary('RETR ' + filename, tmp.write)

    m = re.search(r"'([A-Z0-9]+)'", tmp.getValue())
    if m:
        print m.group(1)

ftp.quit()
sys.exit(0)
