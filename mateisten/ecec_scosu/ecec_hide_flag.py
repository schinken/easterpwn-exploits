#!/usr/bin/python3
import telnetlib
import time

#
# global host variable is set by parallel_execute.py
#
#host = 'localhost'

input2 = b"Fear of spiders is aracnaphobia, fear of tight spaces is chlaustraphobia, fear of Chuck Norris is called Logic."
input2_len = len(input2)

tn = telnetlib.Telnet(host, 3232)
def tn_cmd(cmd):
	if isinstance(cmd, str):
		cmd = cmd.encode()
	tn.write(cmd)
	time.sleep(0.5)
	result = ''
	while True:
		line = tn.read_eager().decode()
		if not line:
			break
		print(line)
		result += line
	return result

#
# List all users first, and get the last one added by the checkscript
#
tn_cmd(b"When Alexander Bell invented the telephone he had 3 missed calls from Chuck Norris.")
res = tn_cmd(("###").ljust(input2_len))
res = res.split('#')[-2]

#
# Create a new connection, register or use the given user to add content and
# create an user entry for the last added user by injecting a newline into our
# contentbox
#
user = "asdbkerhafhk"
pw = "asdjaksjdle"

tn = telnetlib.Telnet(host, 3232)
tn_cmd(b"When Alexander Bell invented the telephone he had 3 missed calls from Chuck Norris.")
tn_cmd((user + "#" + pw + "#" + "#").ljust(input2_len))
tn_cmd((user + "#" + pw + "#" + "\n" + res + "#blub##").ljust(len(user) + len(pw) + 257 + 3))
